{% extends "layouts/base.html" %}

{% block title %} Typography {% endblock %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
<!DOCTYPE html>
<html>

<head>

	<head>

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<title>Test</title>

		<script src="static/assets/js/annotation/less.js"></script>

		<script src="static/assets/js/annotation/jquery-3.5.1.min.js"></script>

		<script src="static/assets/js/annotation/less.js"></script>

		<script src="static/assets/js/annotation/jquery-3.5.1.min.js"></script>

		<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js">  </script>  

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/js/bootstrap.min.js">  </script>   -->


		<!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet"> -->

		<style>
			input {
				width: 100px;
				margin: 8px;
				padding: 5px;
				border-radius: 10px;
			}

			button {
				appearance: none;
				background-color: transparent;
				border: 2px solid #1a1a1a;
				border-radius: 15px;
				box-sizing: border-box;
				color: #3b3b3b;
				cursor: pointer;
				display: inline-block;
				font-family: Roobert, -apple-system, BlinkMacSystemFont, "Segoe UI",
					Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
					"Segoe UI Symbol";
				font-size: 16px;
				font-weight: 600;
				line-height: normal;
				margin: 10px 0px 30px 0px;
				min-height: 30px;
				min-width: 0;
				outline: none;
				padding: 16px 24px;
				text-align: center;
				text-decoration: none;
				transition: all 300ms cubic-bezier(0.23, 1, 0.32, 1);
				user-select: none;
				-webkit-user-select: none;
				touch-action: manipulation;
				will-change: transform;
			}

			button:disabled {
				pointer-events: none;
				background-color: rgb(112, 108, 108);
				background: rgb(129, 122, 122);
				display: none;

			}

			button:hover {
				color: #fff;
				background-color: #1a1a1a;
				box-shadow: rgba(0, 0, 0, 0.25) 0 8px 15px;
				transform: translateY(-2px);
			}

			button:active {
				box-shadow: none;
				transform: translateY(0);
			}

			label {
				margin-left: 30px;
				font-size: 15px;
				width: 80px;
			}

		
		</style>
		

	</head>

<body>

	

	<!-- <div class="page-header">
		<div class="page-block">
			<div class="row align-items-center">
				<div class="col-md-6">
					<div class="page-header-title">
						<h5 class="m-b-10">STRATASPACE-AI</h5>
					</div>
					<ul class="breadcrumb">
						<li class="breadcrumb-item"><a href="index.html">Home</a></li>

						<li class="breadcrumb-item">Pre-Built Models</li>
						<li class="breadcrumb-item"><a href="/autoLabel.html">Auto Label Tool
								</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div> -->
	<div class="pcoded-content"></div>
	<div class="row">
		<!-- [ Typography ] start -->
		<div class="col-sm-12">
			<div class="card">
				<div class="card-header">
					<center>
						<h2>Auto Annotation Tool</h2>
					</center>

				</div>

			</div>

			<!-- <div class="container">
				<div class="row">
				  <div class="col">
					<ul id="progress-bar" class="progressbar">
					  <li class="active">Capturing Dataset</li>
					  <li>Dataset Captured</li>
					  <li>Training...</li>
					  <li>Model Prepared</li>
				   </ul>
				  </div>
			   </div>
			 </div>
			 <div class="btn-container">
			   <button class="btn" id="btnPlay">btnPlay</button>
			   <button class="btn" id="Back">Back</button>
			   <button class="btn" id="Reset">Reset</button>
			 </div> -->

			<div>
				<section>
					<div class="row mt-4">
						<div class="col-lg-7 mb-lg-0 mb-2">
							<div class="card">
							</div>
						</div>
						<center class="col-lg-5"
							<div class="col-lg-4">
								<!-- <div class="demo-container">
									<img id='videoImage' src="" style="display: none;" />
								</div>
								<div>
									<canvas id="drawCanvas" style="cursor: crosshair;"></canvas>
	
								</div> -->
								<div class="card h-100 p-3">
									<form id="urlForm" ,action="/training">
										<label>RTMP URL:</label>
										<input id="rtmpUrl" style="width: 50%" type="text" name="rtmpUrl" value="" />
										<br>
										<label>Tag Name:</label>
										<input id="tagName" style="width: 50%" type="text" name="tagName" value="" />
										<br>

										<button id="btnPlay">Play</button>
										<button id="btnStop" onclick="showtrain()">Stop</button>
										<center><button class="buttonclass" type="submit" id="train"
												style="display:none">Train</button></center>
										
									</form>
									<form action="/downloadModel">
										<button class="buttonclass" type="submit" id="downloadbtn" style="display:none">Download The
											Model</button>
									</form>
								</div>
								<!-- <div class="col-lg-4">
									<div class="demo-container">
										<img id='videoImage' src="" style="display: none;" />
									</div>
									<div>
										<canvas id="drawCanvas" style="cursor: crosshair;"></canvas>
		
									</div>
							</div>
							 -->

						</center>

						<center class="col-lg-5" >
							<div class="demo-container">
								<img id='videoImage' src="" style="display: none;" />
							</div>
							<div>
								<canvas id="drawCanvas" style="cursor: crosshair;"></canvas>

							</div>
						</center>

					</div>
					<br>

				</section>
			</div>
			<script>
				var gDrawing = false;
				var x, y, w, h, canvas;
				var gDrawRect = false;
				function initCanvas() {
					canvas = document.getElementById('drawCanvas');

					canvas.addEventListener("mousedown", function (e) {
						gDrawRect = true;
						x = e.clientX - canvas.offsetLeft;
						y = e.clientY - canvas.offsetTop;
						gDrawRect = true;
					}, false);
					canvas.addEventListener("mouseup", function (e) {
						var xx = e.clientX - canvas.offsetLeft;
						var yy = e.clientY - canvas.offsetTop;
						w = xx - x;
						h = yy - y;
						gDrawRect = false;
						$.ajax({
							url: '/api/addLabel',
							data: { 'x': x, 'y': y, 'w': w, 'h': h, 'label': $("#tagName").val() },
							type: 'POST',
							error: function (result) {
								alert("API has Problem, Try Again!");
							},
							success: function (result) {

							}
						});
					}, false);
				}
				function drawImge() {
					var video = document.querySelector("#videoImage");
					canvas = document.querySelector("#drawCanvas");
					var ctx = canvas.getContext('2d');

					canvas.width = video.width;
					canvas.height = video.height;
					ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
					if (gDrawing) setTimeout(drawImge, 100);
				}
				function showtrain() { $("#train").show(); }
				// function showdwnld() { $("#downloadbtn").show();}
			

				$("#btnPlay").on("click", function (event) {
					event.preventDefault();

					console.log("Playing stream ...");
					var spinner = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>'
					var rtmpUrl = $("#rtmpUrl").val();
					$("#btnPlay").html(spinner);
					// play in image
					$("#videoImage").attr("src", "/video_feed1?url=" + rtmpUrl);
					gDrawing = true;
					setTimeout(drawImge, 300);
					initCanvas();
				});
				$("#btnStop").on("click", function (event) {
					$("#btnPlay").text("DONE").attr('disabled', true);
					event.preventDefault();
					console.log("Stop Stream ...");
					gDrawing = false;
					$("#videoImage").attr("src", "/convert");
					gDrawing = false;
					$("#btnStop").text("DONE").attr('disabled', true);
				});
				$("#spilt").on("click", function (event) {
					event.preventDefault();
					var spinner = '<div class="spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div>'

					$("#spilt").html(spinner);
					$.ajax({

						url: '/SomeFunction',
						error: function (result) {
							alert("something went wrong while training. Try Again!");
						},
						success: function (result) { alert('Done spiliting') },

					}).done((response) => { $("#spilt").text("DONE").attr('disabled', true); })
				});
				$("#train").on("click", function (event) {
					event.preventDefault();
					var spinner = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>'

					$("#train").html(spinner);
					$.ajax({

						url: '/trainingModel',
						error: function (result) {
							alert("something went wrong while training. Try Again!");
						},
						success: function (result) { alert('Done training.You can download the model now') },

					}).done((response) => { $("#train").text("DONE").attr('disabled', true); $("#train").hide();$("#downloadbtn").show()})
				});
				

			</script>
			</script>
			<script type=text/javascript> $(function() { $("#download").click(function (event) { $.getJSON('/downloadModel', { },
		function(data) { }); return false; }); }); 
	</script>
		

		<!-- <script>
			var progressBar = {
  Bar : $('#progress-bar'),
  Reset : function(){
    if (this.Bar){
      this.Bar.find('li').removeClass('active'); 
    }
  },
  btnPlay: function(){
    $('#progress-bar li:not(.active):first').addClass('active');
  },
  Back: function(){
    $('#progress-bar li.active:last').removeClass('active');
  }
}

progressBar.Reset();

////
$("#btnPlay").on('click', function(){
  progressBar.btnPlay();
})
$("#btnStop").on('click', function(){
  progressBar.btnPlay();
})
$("#Back").on('click', function(){
  progressBar.Back();
})
$("#Reset").on('click', function(){
  progressBar.Reset();
})
		</script> -->

			<script async src="static/assets/js/annotation/opencv3.4.16.js" type="text/javascript"></script>
</body>

</html>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}{% endblock javascripts %}